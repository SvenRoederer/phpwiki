<?php // -*-php-*- ?>
<!-- $Id: actionbar.tmpl,v 1.12 2007-01-07 20:19:56 rurban Exp $ -->
<?php
$dbh = $request->getDbh();
$isActionPage = $request->isActionPage($request->getArg("action"));
$isAdmin = $user->isAdmin();
$pagename = $page->getName();
?>
<div class="portlet" id="p-cactions">
  <h5>Views</h5>
  <ul>
    <?php if (!string_ends_with($pagename, _("Discussion"))) { ?>
    <?php $talk = new WikiPageName('Talk:'.$pagename); ?>
      <?= ActionButton(array(),
		       $isActionPage ? _("ActionPage") : _("Article"), 
		       $talk->getParent(), array('class'=>"selected")) ?>
      <?php if (!$isActionPage) { ?>
        <?php if ($dbh->isWikiPage($talk->getName())) { ?>
	  <?= ActionButton(array('action'=>'browse'), _("Discussion"), $talk->getName()) ?>
        <?php } else { ?>
	  <?= ActionButton(array('action'=>'create',
				 'template'=>_("TemplateTalk")),
			   _("Discussion"), $talk->getName()) ?>
        <?php } ?>
      <?php } ?>
    <?php } else {
      $talk = new WikiPageName($pagename); ?>
      <?= ActionButton(array(),$isActionPage ? _("ActionPage") : _("Article"), $talk->getParent()) ?>
      <?= ActionButton(array(),_("Discussion"), $talk->getParent(), array('class'=>"selected")) ?>
    <?php } ?>
    <?php if (($isAdmin or mayAccessPage('edit', $pagename)) and $revision) { ?>
      <?= ActionButton("edit", $revision->isCurrent() ? _("Edit") : _("Edit Old Revision")) ?>
    <?php } else { ?>
      <?= ActionButton("viewsource", _("View Source")) ?>
    <?php } ?>
    <?= ActionButton(_("PageHistory")) ?>
    <?= ActionButton("diff") ?> 
    <? if ( $user->isSignedIn() ) { ?>
      <?= ActionButton("WatchPage", _("Watch")) ?>
    <?php } ?>
  </ul>
</div>
<div class="portlet" id="p-tbx">
  <h5>Special Actions</h5>
  <div class="pBody">
  <ul>
    <? if ( $user->isSignedIn() ) { ?>
     <?php if ($isAdmin or mayAccessPage('change', $pagename)) { ?>
      <?= ActionButton($page->get('locked') ? 'unlock' : 'lock') ?>
      <?= ActionButton('rename') ?>
      <?php if (ENABLE_PAGEPERM and mayAccessPage('change', $pagename)) { ?>
       <?= ActionButton('chown') ?>
       <?= ActionButton('setacl') ?>
     <?php }} ?>
     <?php if (!empty($revision) and ($isAdmin or mayAccessPage('remove', $pagename))) { ?>
      <?= ActionButton('revert',_("Revert"), $revision->isCurrent() ? $page->GetRevisionBefore() : $revision) ?>
      <?= ActionButton('remove') ?>
     <?php } ?>
    <?php } ?>
    <?= ActionButton(array('action'=>_("PageInfo")),
                        _("Info"), $pagename) ?>
    <?= ActionButton(_("PageHistory")) ?>
    <?= ActionButton(_("AuthorHistory")) ?>
    <?= ActionButton("diff") ?> 
    <?= ActionButton(_("PageDump")) ?>
    <?php if (DEBUG & _DEBUG_SQL and USECACHE) {
      $PurgeCache = Button(array('nocache' => 'purge'),
                     _("PurgeHtmlCache"), $pagename);
      $PurgeCache->addTooltip(_("Purge HTML cache for this page. Regenerate from WikiMarkup when next accessed.")); ?>
      <?= $PurgeCache ?>
    <?php } ?>
  </div>
  </ul>
</div>
