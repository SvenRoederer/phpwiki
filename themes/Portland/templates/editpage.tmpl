<!-- -*-html-*- -->
<!-- $Id: editpage.tmpl,v 1.10 2002-01-28 01:01:27 dairiki Exp $ -->
<?php
$SummaryInput = HTML::input(array('type' => 'text',
                                  'class' => 'wikitext',
                                  'name' => 'summary',
                                  'size' => 50,
                                  'value' => $FORMVARS['summary']));

$MinorEditCb = HTML::input(array('type' => 'checkbox',
                                 'name' => 'minor_edit',
                                 'checked' => (bool) $FORMVARS['minor_edit']));

$PreviewB = HTML::input(array('type' => 'submit',
                              'class' => 'button',
                              'name' => 'preview',
                              'value' => _("Preview")));
$SaveB = HTML::input(array('type' => 'submit',
                           'class' => 'button',
                           'name' => 'save',
                           'value' => _("Save")));

$WidthI = HTML::input(array('type' => 'text',
                            'size' => 3,
                            'name' => 'pref[editWidth]',
                            'value' => $request->getPref('editWidth'),
                            'onchange' => 'this.form.submit();'));

$HeightI = HTML::input(array('type' => 'text',
                             'size' => 3,
                             'name' => 'pref[editHeight]',
                             'value' => $request->getPref('editHeight'),
                             'onchange' => 'this.form.submit();'));

$AdjustB = $Theme->makeButton(_("Adjust"), "submit:");


$GoodStyleB = $Theme->makeLinkButton(_("GoodStyle"));


$Markup['old'] = new HtmlElement('option', array('value' => 'old'),
                                _("Old"));
$Markup['new'] = new HtmlElement('option', array('value' => 'new'),
                                 _("New"));
$selected = $FORMVARS['markup'] == 'new' ? 'new' : 'old';
$Markup[$selected]->setAttr('selected', true);
$MarkupSelect = new HtmlElement('select', array('name' => 'markup'),
                                $Markup);

  $s = $Theme->getButtonSeparator();
?>

<?php /*
 * FIXME: Hack! 
 * The funky URL used for the form action parameter is bogus.
 * This is needed, otherwise the redirect to the real browser
 * page won't work with some browsers. (NS4 and Mozilla 0.97 won't accept
 * a redirect from a page to itself.)
 *
 * <textarea wrap="virtual"> is not valid xhtml but Netscape 4 requires it
 * to wrap long lines.
 *
 */ ?>

<form method="post" name="editpage"
      action="<?=WikiURL($page,array('action'=>'edit'))?>"
      accept-charset="<?=CHARSET?>">
<table summary="Toolbar: Save, Preview, and edit warnings." class="toolbar" width="100%"
       cellpadding="0" cellspacing="0" border="0"><tr align="baseline">
  <td>
    <?php if (!$revision->isCurrent()) { ?>
      <p><strong><?=_("Warning: You are editing an old revision.")?>
            <?=_("Saving this page will overwrite the current version.")?></strong></p>
    <?php } ?>
    <?php if (isset($PREVIEW_CONTENT)) { ?>
      <p><strong><?=_("Preview only!  Changes not saved.")?></strong></p>
    <?php } ?>
  </td>
  <td align="right"><?= $PreviewB ?><?=$s?><?= $SaveB ?></td></tr>
  <?php if (isset($PREVIEW_CONTENT)) { ?>
    <tr><td colspan="2">
      <hr />
      <div class="wikitext"><?= $PREVIEW_CONTENT ?></div>
    </td></tr>
  <?php } ?>
</table>
<textarea class="wikiedit"
          name="content"
          rows="<?=$request->getPref('editHeight')?>"
          cols="<?=$request->getPref('editWidth')?>"
          wrap="virtual"><?=$FORMVARS['content']?></textarea>
<br />
<?=_("Summary:")?> <?= $SummaryInput ?>
<br />
<?= fmt("Author will be logged as %s.", HTML::em($user->getId())) ?>
<br />
<?= $MinorEditCb ?>
<?= fmt("I'm just doing minor edits. Please divert the usual logging to %s instead.",
        $Theme->linkExistingWikiWord(_("RecentEdits"))) ?>
<br />
<p>
  <?=_("Edit Area Size:")?> <b><?=_("H")?></b>
  <?=$HeightI?>
  <b><?=_("W")?></b>
  <?=$WidthI?>
  <?=$AdjustB?>
  <br />
  Markup Style: <?=$MarkupSelect?>
</p>
<!-- FIXME: do we need this at all?  If so, it could probably be moved to TextFormattingRules -->
<p><?= fmt("See %s tips for editing.", $GoodStyleB) ?></p>
<div class="wiki-edithelp">
<?plugin IncludePage page=_("TextFormattingRules") section=_("Synopsis") quiet=1?>
</div>
<input type="hidden" name="action" value="save" />
<input type="hidden" name="pagename" value="<?=$FORMVARS['pagename']?>" />
<input type="hidden" name="editversion" value="<?=$FORMVARS['editversion']?>" />
<input type="hidden" name="version" value="<?=$FORMVARS['version']?>" />
</form>
<hr />
